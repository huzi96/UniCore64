From 8fee2933475bdffb1911dea6f0cf28109d26c167 Mon Sep 17 00:00:00 2001
From: yuyue <yuyue@mprc.pku.edu.cn>
Date: Wed, 7 Dec 2011 09:30:19 +0800
Subject: [PATCH 121/641] UniCore64: add enable icache and dcache macros

Signed-off-by: yuyue <yuyue@mprc.pku.edu.cn>
---
 arch/unicore64/include/arch/asm-mmuops.h |   30 ++++++++++++++++++++++++++----
 1 file changed, 26 insertions(+), 4 deletions(-)

diff --git a/arch/unicore64/include/arch/asm-mmuops.h b/arch/unicore64/include/arch/asm-mmuops.h
index 55408fa..f9e9a03 100644
--- a/arch/unicore64/include/arch/asm-mmuops.h
+++ b/arch/unicore64/include/arch/asm-mmuops.h
@@ -6,7 +6,7 @@
 /**
  * uc64_invalidate_dcache - invalidate entire L1 dcache
  */
-__ASMMACRO_WRAP(.macro uc64_invalidate_dcache, rt;
+__ASMMACRO_WRAP(.macro	uc64_invalidate_dcache, rt;
 			dmovl	&rt, #0;
 			movc	p0.c6, &rt, #8;
 		.endm)
@@ -14,7 +14,7 @@ __ASMMACRO_WRAP(.macro uc64_invalidate_dcache, rt;
 /**
  * uc64_flush_dcache - flush entire L1 dcache
  */
-__ASMMACRO_WRAP(.macro uc64_flush_dcache, rt;
+__ASMMACRO_WRAP(.macro	uc64_flush_dcache, rt;
 			dmovl	&rt, #0;
 			movc	p0.c6, &rt, #12;
 		.endm)
@@ -22,7 +22,7 @@ __ASMMACRO_WRAP(.macro uc64_flush_dcache, rt;
 /**
  * uc64_invalidate_icache - invalidate entire icache
  */
-__ASMMACRO_WRAP(.macro uc64_invalidate_icache, rt;
+__ASMMACRO_WRAP(.macro	uc64_invalidate_icache, rt;
 			dmovl	&rt, #0;
 			movc	p0.c7, &rt, #0;
 		.endm)
@@ -30,9 +30,31 @@ __ASMMACRO_WRAP(.macro uc64_invalidate_icache, rt;
 /**
  * uc64_invalidate_tlb - invalidate I&D tlb
  */
-__ASMMACRO_WRAP(.macro uc64_invalidate_tlb, rt;
+__ASMMACRO_WRAP(.macro	uc64_invalidate_tlb, rt;
 			dmovl	&rt, #0;
 			movc	p0.c5, &rt, #24;
 		.endm)
 
+/**
+ * uc64_enable_dcache -  enable dcache
+ */
+__ASMMACRO_WRAP(.macro	uc64_enable_dcache, rt;
+#ifndef CONFIG_CPU_DCACHE_DISABLE
+			movc	&rt, p0.c1, #0;
+			dor	&rt, &rt, #4;
+			movc	p0.c1, &rt, #0;
+#endif
+		.endm)
+
+/**
+ * uc64_enable_icache -  enable icache
+ */
+__ASMMACRO_WRAP(.macro	uc64_enable_icache, rt;
+#ifndef CONFIG_CPU_ICACHE_DISABLE
+			movc	&rt, p0.c1, #0;
+			dor	&rt, &rt, #8;
+			movc	p0.c1, &rt, #0;
+#endif
+		.endm)
+
 #endif /* __UNICORE64_ARCH_ASM_MMUOPS_H__ */
-- 
1.7.9.5

