From 3eabd2ce00833d05a5130083d1061406e3838e93 Mon Sep 17 00:00:00 2001
From: GuanXuetao <gxt@mprc.pku.edu.cn>
Date: Sat, 10 Dec 2011 14:28:54 +0800
Subject: [PATCH 146/641] UniCore64: introduce BFMASK_NOT

Signed-off-by: GuanXuetao <gxt@mprc.pku.edu.cn>
---
 arch/unicore64/include/arch/bitfield.h |    6 ++++--
 arch/unicore64/include/asm/page.h      |    2 +-
 arch/unicore64/include/asm/pgtable.h   |    4 ++--
 3 files changed, 7 insertions(+), 5 deletions(-)

diff --git a/arch/unicore64/include/arch/bitfield.h b/arch/unicore64/include/arch/bitfield.h
index 2d8e1a1..114b88c 100644
--- a/arch/unicore64/include/arch/bitfield.h
+++ b/arch/unicore64/include/arch/bitfield.h
@@ -8,8 +8,10 @@
 
 #include <linux/const.h>
 
-#define BFSIZE(vbits)		(_AC(1, UL) << (vbits))
-#define BFMASK(vmask, vshift)	(((BFSIZE(vmask)) - 1) << (vshift))
+#define BFSIZE(vbits)			(_AC(1, UL) << (vbits))
+#define BFMASK(vmask, vshift)		(((BFSIZE(vmask)) - 1) << (vshift))
+#define BFMASK_NOT(vmask, vshift)	(~BFMASK(vmask, vshift))
+
 #define BFIELD(val, vmask, vshift)		\
 		(((val) << (vshift)) & BFMASK(vmask, vshift))
 
diff --git a/arch/unicore64/include/asm/page.h b/arch/unicore64/include/asm/page.h
index 84bc093..da1f6da 100644
--- a/arch/unicore64/include/asm/page.h
+++ b/arch/unicore64/include/asm/page.h
@@ -10,7 +10,7 @@
 /* PAGE_SHIFT determines the page size */
 #define PAGE_SHIFT		UC64_PAGE_BITS
 #define PAGE_SIZE		UC64_PAGE_SIZE
-#define PAGE_MASK		(~(UC64_PAGE_MASK))
+#define PAGE_MASK		BFMASK_NOT(PAGE_SHIFT, 0)
 
 #ifndef __ASSEMBLY__
 
diff --git a/arch/unicore64/include/asm/pgtable.h b/arch/unicore64/include/asm/pgtable.h
index 0a27784..eaf2824 100644
--- a/arch/unicore64/include/asm/pgtable.h
+++ b/arch/unicore64/include/asm/pgtable.h
@@ -16,11 +16,11 @@
 
 #define PGDIR_SHIFT		UC64_PGD_SHIFT
 #define PGDIR_SIZE		UC64_PGD_SIZE
-#define PGDIR_MASK		(~(PGDIR_SIZE-1))
+#define PGDIR_MASK		BFMASK_NOT(PGDIR_SHIFT, 0)
 
 #define PMD_SHIFT		UC64_PMD_SHIFT
 #define PMD_SIZE		UC64_PMD_SIZE
-#define PMD_MASK		(~(PMD_SIZE-1))
+#define PMD_MASK		BFMASK_NOT(PMD_SHIFT, 0)
 
 #define PTRS_PER_PGD		BFSIZE(UC64_PGD_BITS)
 #define PTRS_PER_PMD		BFSIZE(UC64_PMD_BITS)
-- 
1.7.9.5

