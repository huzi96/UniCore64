From dfa1db3d10bf0c822c395d0991d8fb64f19230ca Mon Sep 17 00:00:00 2001
From: yuyue <yuyue@mprc.pku.edu.cn>
Date: Thu, 15 Dec 2011 10:19:14 +0800
Subject: [PATCH 171/641] UniCore64: add function uc64_debug_puts

Signed-off-by: yuyue <yuyue@mprc.pku.edu.cn>
---
 arch/unicore64/lib/Makefile |    2 +-
 arch/unicore64/lib/debug.S  |   33 +++++++++++++++++++++++++++++++++
 2 files changed, 34 insertions(+), 1 deletion(-)
 create mode 100644 arch/unicore64/lib/debug.S

diff --git a/arch/unicore64/lib/Makefile b/arch/unicore64/lib/Makefile
index ddab932..88ee607 100644
--- a/arch/unicore64/lib/Makefile
+++ b/arch/unicore64/lib/Makefile
@@ -1,4 +1,4 @@
-lib-y			:= delay.o
+lib-y			:= delay.o debug.o
 
 GNU_LIBC_A		:= $(shell $(CC) $(KBUILD_CFLAGS) -print-file-name=libc.a)
 GNU_LIBC_A_OBJS		:= memchr.o memcpy.o memmove.o memset.o wordcopy.o
diff --git a/arch/unicore64/lib/debug.S b/arch/unicore64/lib/debug.S
new file mode 100644
index 0000000..ae0e73d
--- /dev/null
+++ b/arch/unicore64/lib/debug.S
@@ -0,0 +1,33 @@
+#include <linux/linkage.h>
+#include <arch/asm-common.h>
+#include <arch/asm-debug.h>
+
+#define UC64_DEBUG_PUTS_MAX	256
+
+/**
+ * uc64_debug_puts - print a string less than 256.
+ * r0: the address of the string
+ * r1: the max length of the string
+ */
+ENTRY(uc64_debug_puts)
+	dmov	r1, #UC64_DEBUG_PUTS_MAX
+
+1001:	ldb.w	r2, [r0]+, #1
+	dcsub.a r2, #0
+	beq	1003f
+
+	uc64_debug_putchar	r2
+
+	dsub.a	r1, r1, #1
+	bsl	1002f
+	b	1001b
+
+1002:	adr	r0, 1004f
+	b	uc64_debug_puts
+
+1003:	return
+
+1004:
+	.asciz	"\nWarning: String is too long in uc64_debug_puts.\n"
+	.align 4
+ENDPROC(uc64_debug_puts)
-- 
1.7.9.5

