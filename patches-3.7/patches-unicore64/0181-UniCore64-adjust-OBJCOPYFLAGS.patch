From 76fa4accef457303442b6fe909dac0e82378bf21 Mon Sep 17 00:00:00 2001
From: GuanXuetao <gxt@mprc.pku.edu.cn>
Date: Fri, 16 Dec 2011 20:19:24 +0800
Subject: [PATCH 181/641] UniCore64: adjust OBJCOPYFLAGS

Signed-off-by: GuanXuetao <gxt@mprc.pku.edu.cn>
---
 arch/unicore64/Makefile      |    2 --
 arch/unicore64/boot/Makefile |    3 +++
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/arch/unicore64/Makefile b/arch/unicore64/Makefile
index a98f6c1..68bfcc1 100644
--- a/arch/unicore64/Makefile
+++ b/arch/unicore64/Makefile
@@ -21,8 +21,6 @@ KBUILD_DEFCONFIG	:= $(ARCH)_defconfig
 
 LDFLAGS_vmlinux		:= --no-undefined -X
 
-OBJCOPYFLAGS		:= -O binary -R .note -R .note.gnu.build-id -R .comment -S
-
 # Never use hard float in kernel
 KBUILD_CFLAGS		+= -msoft-float
 
diff --git a/arch/unicore64/boot/Makefile b/arch/unicore64/boot/Makefile
index 59438c3..3c65efe 100644
--- a/arch/unicore64/boot/Makefile
+++ b/arch/unicore64/boot/Makefile
@@ -4,6 +4,9 @@ targets		:= Image piggy.bin boot.lds boot.bin zImage
 # Do not recognize built-in functions in uncompress.c
 EXTRA_CFLAGS	:= -fno-builtin
 
+# Only copy text segment from boot.bin to zImage
+OBJCOPYFLAGS	:= -O binary -S
+
 $(obj)/Image: vmlinux FORCE
 	$(call if_changed,objcopy)
 	@echo '  Kernel: $@ is ready'
-- 
1.7.9.5

