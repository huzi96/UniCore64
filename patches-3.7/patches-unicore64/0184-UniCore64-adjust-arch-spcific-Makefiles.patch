From e5c91093a196fa6c0469f313a2d2ce9d37addb11 Mon Sep 17 00:00:00 2001
From: GuanXuetao <gxt@mprc.pku.edu.cn>
Date: Tue, 20 Dec 2011 12:32:42 +0800
Subject: [PATCH 184/641] UniCore64: adjust arch-spcific Makefiles

Signed-off-by: GuanXuetao <gxt@mprc.pku.edu.cn>
---
 arch/unicore64/Makefile        |   15 +++++----------
 arch/unicore64/kernel/Makefile |   16 ++++++++++++----
 2 files changed, 17 insertions(+), 14 deletions(-)

diff --git a/arch/unicore64/Makefile b/arch/unicore64/Makefile
index 68bfcc1..a5d7ef9 100644
--- a/arch/unicore64/Makefile
+++ b/arch/unicore64/Makefile
@@ -18,31 +18,26 @@ endif
 
 # Provide the path to use for "make defconfig".
 KBUILD_DEFCONFIG	:= $(ARCH)_defconfig
-
-LDFLAGS_vmlinux		:= --no-undefined -X
-
 # Never use hard float in kernel
 KBUILD_CFLAGS		+= -msoft-float
+# LDFLAGS for vmlinux in srctree
+LDFLAGS_vmlinux		:= --no-undefined -X
 
-head-y			:= arch/unicore64/kernel/head.o
-#head-y			+= arch/unicore64/kernel/init_task.o
+BOOT_DIR		:= arch/unicore64/boot/
+DOC_DIR			:= Documentation/DocBook/
 
 core-y			+= arch/unicore64/kernel/
 core-y			+= arch/unicore64/mm/
-
 libs-y			+= arch/unicore64/lib/
 
 all:	zImage
 
-BOOT_DIR		:= arch/unicore64/boot/
-
 zImage: vmlinux
 	$(Q)$(MAKE) $(build)=$(BOOT_DIR) $(BOOT_DIR)/$@
 
 archclean:
 	$(Q)$(MAKE) $(clean)=$(BOOT_DIR)
 
-DOC_DIR			:= Documentation/DocBook
 archdoc:
 	$(Q)$(MAKE) $(build)=scripts build_docproc
 	$(Q)$(MAKE) $(build)=$(DOC_DIR) DOCBOOKS=unicore64-kernel.xml pdfdocs
@@ -50,5 +45,5 @@ archdoc:
 define archhelp
 	echo  '  defconfig     - Use arch/$(ARCH)/configs/$(KBUILD_DEFCONFIG)'
 	echo  '  archdoc       - Generate $(DOC_DIR)/unicore64-kernel.pdf'
-	echo  ' *zImage        - Compressed kernel image (arch/$(ARCH)/boot/zImage)'
+	echo  '* zImage        - Compressed kernel image (arch/$(ARCH)/boot/zImage)'
 endef
diff --git a/arch/unicore64/kernel/Makefile b/arch/unicore64/kernel/Makefile
index 90386e9..9796b21 100644
--- a/arch/unicore64/kernel/Makefile
+++ b/arch/unicore64/kernel/Makefile
@@ -1,4 +1,12 @@
-obj-y			:= ptrace.o setup.o init_task.o process.o
-obj-y			+= time.o traps.o irq.o cpu-uc64.o sys.o entry.o
-head-y			:= head.o
-extra-y			:= $(head-y) vmlinux.lds
+#
+# Makefile for the arch/unicore64/kernel.
+#
+obj-y			:= head.o entry.o
+obj-y			+= init_task.o irq.o
+obj-y			+= process.o ptrace.o
+obj-y			+= setup.o sys.o
+obj-y			+= time.o traps.o
+
+obj-$(CONFIG_UNICORE64)	+= cpu-uc64.o
+
+extra-y			:= vmlinux.lds
-- 
1.7.9.5

