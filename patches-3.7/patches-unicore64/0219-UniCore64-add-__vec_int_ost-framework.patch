From 4e27f721d54fc4d90ddd8cf8cececc40414bc94d Mon Sep 17 00:00:00 2001
From: Guan Xuetao <gxt@mprc.pku.edu.cn>
Date: Mon, 16 Jan 2012 13:09:00 +0800
Subject: [PATCH 219/641] UniCore64: add __vec_int_ost framework

Signed-off-by: Guan Xuetao <gxt@mprc.pku.edu.cn>
---
 arch/unicore64/kernel/entry.S |   20 +++++++++++++++++++-
 1 file changed, 19 insertions(+), 1 deletion(-)

diff --git a/arch/unicore64/kernel/entry.S b/arch/unicore64/kernel/entry.S
index c612cd9..78cc374 100644
--- a/arch/unicore64/kernel/entry.S
+++ b/arch/unicore64/kernel/entry.S
@@ -1,4 +1,15 @@
 #include <linux/linkage.h>
+#include <arch/asm-common.h>
+
+	.macro	__priv_context_save
+	/* save all registers */
+	push_lr
+	.endm
+
+	.macro __priv_context_restore
+	/* restore all registers */
+	pop_lr
+	.endm
 
 /**
  * __switch_to - Register switch for UniCore3 processors
@@ -18,6 +29,13 @@ ENTRY(__vectors_table)
 	bkpt	0x1c	/* 0x1c: INT_FAULT */
 	bkpt	0x20	/* 0x20: INT_TIMER */
 	bkpt	0x24	/* 0x24: INT_PE */
-	bkpt	0x28	/* 0x28: INT_OST */
+	b	__vec_int_ost	/* 0x28: INT_OST */
 	bkpt	0x2c	/* 0x2c: INT_PM */
 ENDPROC(__vectors_table)
+
+ENTRY(__vec_int_ost)
+	__priv_context_save
+
+	__priv_context_restore
+	eret
+ENDPROC(__vec_int_ost)
-- 
1.7.9.5

