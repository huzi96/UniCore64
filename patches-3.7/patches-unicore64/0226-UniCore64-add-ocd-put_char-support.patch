From bbb6c22d7a3070dc6becf4101ee6ed70341ebf80 Mon Sep 17 00:00:00 2001
From: Guan Xuetao <gxt@mprc.pku.edu.cn>
Date: Tue, 17 Jan 2012 09:20:13 +0800
Subject: [PATCH 226/641] UniCore64: add ocd put_char support

Signed-off-by: Guan Xuetao <gxt@mprc.pku.edu.cn>
---
 arch/unicore64/include/arch/asm-debug.h |   20 ++++++++++++++++----
 arch/unicore64/lib/debug.S              |    2 +-
 2 files changed, 17 insertions(+), 5 deletions(-)

diff --git a/arch/unicore64/include/arch/asm-debug.h b/arch/unicore64/include/arch/asm-debug.h
index 0b165b7..9243234 100644
--- a/arch/unicore64/include/arch/asm-debug.h
+++ b/arch/unicore64/include/arch/asm-debug.h
@@ -4,11 +4,23 @@
 #include <arch/asm-common.h>
 
 /**
-  * uc64_debug_putchar - prints a 8 bits char
-  */
+ * uc64_debug_putchar - prints a 8 bits char
+ */
 #ifdef	CONFIG_DEBUG_OCD
-__ASMMACRO_WRAP(.macro	uc64_debug_putchar, rt;
-			movc	p6.c0, &rt, #1;
+/* For OCD debug mode */
+__ASMMACRO_WRAP(.macro	uc64_debug_putchar, rchar, rt1, rt2;
+			mov	&rt1, r0;
+			mov	&rt2, r1;
+			mov	r0, #0;
+			mov	r1, &rchar;
+			bkpt;
+			mov	r0, &rt1;
+			mov	r1, &rt2;
+		.endm)
+#else
+/* For RTL simulation environment */
+__ASMMACRO_WRAP(.macro	uc64_debug_putchar, rchar, rt1, rt2;
+			movc	p6.c0, &rchar, #1;
 		.endm)
 #endif /* CONFIG_DEBUG_OCD */
 
diff --git a/arch/unicore64/lib/debug.S b/arch/unicore64/lib/debug.S
index ae0e73d..c81611c2 100644
--- a/arch/unicore64/lib/debug.S
+++ b/arch/unicore64/lib/debug.S
@@ -16,7 +16,7 @@ ENTRY(uc64_debug_puts)
 	dcsub.a r2, #0
 	beq	1003f
 
-	uc64_debug_putchar	r2
+	uc64_debug_putchar	r2, r14, r15
 
 	dsub.a	r1, r1, #1
 	bsl	1002f
-- 
1.7.9.5

