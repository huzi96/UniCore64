From 0ef98a61fb34f563b7dbf22cdb7fb7845eaf0aef Mon Sep 17 00:00:00 2001
From: Guan Xuetao <gxt@mprc.pku.edu.cn>
Date: Wed, 18 Jan 2012 05:08:16 +0800
Subject: [PATCH 241/641] UniCore64: introduce string-simple.c

Signed-off-by: Guan Xuetao <gxt@mprc.pku.edu.cn>
---
 arch/unicore64/boot/Makefile        |    4 +---
 arch/unicore64/include/asm/string.h |    6 ------
 arch/unicore64/lib/Makefile         |    7 +------
 arch/unicore64/lib/string-simple.c  |   18 ++++++++++++++++++
 4 files changed, 20 insertions(+), 15 deletions(-)
 create mode 100644 arch/unicore64/lib/string-simple.c

diff --git a/arch/unicore64/boot/Makefile b/arch/unicore64/boot/Makefile
index ca42b70..4e3849f 100644
--- a/arch/unicore64/boot/Makefile
+++ b/arch/unicore64/boot/Makefile
@@ -26,9 +26,7 @@ $(obj)/%.dtb: $(obj)/%.dts FORCE
 
 $(obj)/boot-head.o: $(obj)/piggy.bin $(obj)/unicore64-fpga.dtb
 
-BOOT_OBJS	:= $(srctree)/arch/unicore64/lib/memcpy.o
-BOOT_OBJS	+= $(srctree)/arch/unicore64/lib/memset.o
-BOOT_OBJS	+= $(srctree)/arch/unicore64/lib/wordcopy.o
+BOOT_OBJS	:= $(srctree)/arch/unicore64/lib/string-simple.o
 BOOT_OBJS	+= $(srctree)/arch/unicore64/lib/debug.o
 BOOT_OBJS	+= $(obj)/uncompress.o
 
diff --git a/arch/unicore64/include/asm/string.h b/arch/unicore64/include/asm/string.h
index 6604755..657e0ed 100644
--- a/arch/unicore64/include/asm/string.h
+++ b/arch/unicore64/include/asm/string.h
@@ -4,12 +4,6 @@
 #define __HAVE_ARCH_MEMCPY
 extern void *memcpy(void *, const void *, __kernel_size_t);
 
-#define __HAVE_ARCH_MEMMOVE
-extern void *memmove(void *, const void *, __kernel_size_t);
-
-#define __HAVE_ARCH_MEMCHR
-extern void *memchr(const void *, int, __kernel_size_t);
-
 #define __HAVE_ARCH_MEMSET
 extern void *memset(void *, int, __kernel_size_t);
 
diff --git a/arch/unicore64/lib/Makefile b/arch/unicore64/lib/Makefile
index 88ee607..0583feb 100644
--- a/arch/unicore64/lib/Makefile
+++ b/arch/unicore64/lib/Makefile
@@ -1,7 +1,2 @@
 lib-y			:= delay.o debug.o
-
-GNU_LIBC_A		:= $(shell $(CC) $(KBUILD_CFLAGS) -print-file-name=libc.a)
-GNU_LIBC_A_OBJS		:= memchr.o memcpy.o memmove.o memset.o wordcopy.o
-lib-y			+= $(GNU_LIBC_A_OBJS)
-$(addprefix $(obj)/, $(GNU_LIBC_A_OBJS)):
-	$(Q)$(AR) p $(GNU_LIBC_A) $(notdir $@) > $@
+lib-y			+= string-simple.o
diff --git a/arch/unicore64/lib/string-simple.c b/arch/unicore64/lib/string-simple.c
new file mode 100644
index 0000000..295ff31
--- /dev/null
+++ b/arch/unicore64/lib/string-simple.c
@@ -0,0 +1,18 @@
+void *memset(void *s, int c, unsigned long count)
+{
+	char *xs = s;
+
+	while (count--)
+		*xs++ = c;
+	return s;
+}
+
+void *memcpy(void *dest, const void *src, unsigned long count)
+{
+	char *tmp = dest;
+	const char *s = src;
+
+	while (count--)
+		*tmp++ = *s++;
+	return dest;
+}
-- 
1.7.9.5

