From 7e38fbba0850394e2a27c78e919043ad34d905e5 Mon Sep 17 00:00:00 2001
From: Guan Xuetao <gxt@mprc.pku.edu.cn>
Date: Thu, 19 Jan 2012 13:31:06 +0800
Subject: [PATCH 259/641] UniCore64: split UC64_IO2VM to PUV3_IOMEM  and
 PUV3_IOREG

Signed-off-by: Guan Xuetao <gxt@mprc.pku.edu.cn>
---
 arch/unicore64/include/arch/hwdef-memory.h |    2 --
 arch/unicore64/include/arch/puv3-gpio.h    |   16 ++++++++--------
 arch/unicore64/include/arch/puv3-intc.h    |   12 ++++++------
 arch/unicore64/include/arch/puv3-iomem.h   |   15 ++++++++++++---
 4 files changed, 26 insertions(+), 19 deletions(-)

diff --git a/arch/unicore64/include/arch/hwdef-memory.h b/arch/unicore64/include/arch/hwdef-memory.h
index d4a9dc8..443daf9 100644
--- a/arch/unicore64/include/arch/hwdef-memory.h
+++ b/arch/unicore64/include/arch/hwdef-memory.h
@@ -57,8 +57,6 @@
 #define UC64_VM_IO_START		__BC(ffffffef, 80000000)
 #define UC64_VM_IO_END			UC64_VM_DMAP_END
 
-#define UC64_IO2VM(ioaddr)		(UC64_VM_IO_START + (ioaddr))
-
 /* FIXME */
 #define UC64_VM_VMALLOC_START		__BC(00000001, 00000000)
 #define UC64_VM_VMALLOC_END		__BC(00000002, 00000000)
diff --git a/arch/unicore64/include/arch/puv3-gpio.h b/arch/unicore64/include/arch/puv3-gpio.h
index f636468..19f11b0 100644
--- a/arch/unicore64/include/arch/puv3-gpio.h
+++ b/arch/unicore64/include/arch/puv3-gpio.h
@@ -15,14 +15,14 @@
  * Edge Status Reg GPIO_GEDR.
  * Sepcial Voltage Detect Reg GPIO_GPIR.
  */
-#define GPIO_GPLR		(PUV3_GPIO_BASE + 0x0000)
-#define GPIO_GPDR		(PUV3_GPIO_BASE + 0x0004)
-#define GPIO_GPSR		(PUV3_GPIO_BASE + 0x0008)
-#define GPIO_GPCR		(PUV3_GPIO_BASE + 0x000C)
-#define GPIO_GRER		(PUV3_GPIO_BASE + 0x0010)
-#define GPIO_GFER		(PUV3_GPIO_BASE + 0x0014)
-#define GPIO_GEDR		(PUV3_GPIO_BASE + 0x0018)
-#define GPIO_GPIR		(PUV3_GPIO_BASE + 0x0020)
+#define GPIO_GPLR		PUV3_IOREG(PUV3_GPIO_BASE + 0x0000)
+#define GPIO_GPDR		PUV3_IOREG(PUV3_GPIO_BASE + 0x0004)
+#define GPIO_GPSR		PUV3_IOREG(PUV3_GPIO_BASE + 0x0008)
+#define GPIO_GPCR		PUV3_IOREG(PUV3_GPIO_BASE + 0x000C)
+#define GPIO_GRER		PUV3_IOREG(PUV3_GPIO_BASE + 0x0010)
+#define GPIO_GFER		PUV3_IOREG(PUV3_GPIO_BASE + 0x0014)
+#define GPIO_GEDR		PUV3_IOREG(PUV3_GPIO_BASE + 0x0018)
+#define GPIO_GPIR		PUV3_IOREG(PUV3_GPIO_BASE + 0x0020)
 
 #define GPIO_MIN		(0)
 #define GPIO_MAX		(27)
diff --git a/arch/unicore64/include/arch/puv3-intc.h b/arch/unicore64/include/arch/puv3-intc.h
index 35bcc95..daca4ed 100644
--- a/arch/unicore64/include/arch/puv3-intc.h
+++ b/arch/unicore64/include/arch/puv3-intc.h
@@ -13,11 +13,11 @@
  * INTC REAL Pending Reg INTC_ICFP.
  * INTC Control Reg INTC_ICCR.
  */
-#define INTC_ICLR		(PUV3_INTC_BASE + 0x0000)
-#define INTC_ICMR		(PUV3_INTC_BASE + 0x0004)
-#define INTC_ICPR		(PUV3_INTC_BASE + 0x0008)
-#define INTC_ICIP		(PUV3_INTC_BASE + 0x000C)
-#define INTC_ICFP		(PUV3_INTC_BASE + 0x0010)
-#define INTC_ICCR		(PUV3_INTC_BASE + 0x0014)
+#define INTC_ICLR		PUV3_IOREG(PUV3_INTC_BASE + 0x0000)
+#define INTC_ICMR		PUV3_IOREG(PUV3_INTC_BASE + 0x0004)
+#define INTC_ICPR		PUV3_IOREG(PUV3_INTC_BASE + 0x0008)
+#define INTC_ICIP		PUV3_IOREG(PUV3_INTC_BASE + 0x000C)
+#define INTC_ICFP		PUV3_IOREG(PUV3_INTC_BASE + 0x0010)
+#define INTC_ICCR		PUV3_IOREG(PUV3_INTC_BASE + 0x0014)
 
 #endif /* __UNICORE64_ARCH_PUV3_INTC__ */
diff --git a/arch/unicore64/include/arch/puv3-iomem.h b/arch/unicore64/include/arch/puv3-iomem.h
index 3d5ef95..f6ddfb2 100644
--- a/arch/unicore64/include/arch/puv3-iomem.h
+++ b/arch/unicore64/include/arch/puv3-iomem.h
@@ -1,8 +1,17 @@
 #ifndef __UNICORE64_ARCH_PUV3_IOMEM_H__
 #define __UNICORE64_ARCH_PUV3_IOMEM_H__
 
+#include <linux/types.h>
 #include <arch/hwdef-memory.h>
 
+#ifndef __ASSEMBLY__
+#define PUV3_IOMEM(x)			(resource_size_t)(UC64_VM_IO_START + (x))
+#define PUV3_IOREG(x)			(void __iomem *)(x)
+#else
+#define PUV3_IOMEM(x)			(UC64_VM_IO_START + (x))
+#define PUV3_IOREG(x)			(x)
+#endif
+
 #define PUV3_IOMEM_REGION		__BS(12, 0)
 
 /*
@@ -13,7 +22,7 @@
  * 0x90000000 - 0x97FFFFFF 128MB  PCI AHB-PCI MEM-mapping
  * 0x98000000 - 0x9FFFFFFF 128MB  PCI PCI-AHB MEM-mapping
  */
-#define PUV3_PCI_BASE			UC64_IO2VM(0x00000000)
+#define PUV3_PCI_BASE			PUV3_IOMEM(0x00000000)
 #define PUV3_PCICFG_BASE		(PUV3_PCI_BASE + 0x0)
 #define PUV3_PCIBRI_BASE		(PUV3_PCI_BASE + 0x00010000)
 #define PUV3_PCILIO_BASE		(PUV3_PCI_BASE + 0x00030000)
@@ -23,7 +32,7 @@
 /*
  * PUV3 System Bus Addresses (AHB): 0xC0000000 - 0xEDFFFFFF (640MB)
  */
-#define PUV3_AHB_BASE			UC64_IO2VM(0x40000000)
+#define PUV3_AHB_BASE			PUV3_IOMEM(0x40000000)
 
 /* AHB-0 is DDR2 SDRAM */
 /* AHB-1 is PCI Space */
@@ -44,7 +53,7 @@
 /*
  * PUV3 Peripheral Bus Addresses (APB): 0xEE000000 - 0xEFFFFFFF (128MB)
  */
-#define PUV3_APB_BASE			UC64_IO2VM(0x6E000000)
+#define PUV3_APB_BASE			PUV3_IOMEM(0x6E000000)
 
 #define PUV3_UART0_BASE			(PUV3_APB_BASE + 0x000000) /* APB-0 */
 #define PUV3_UART1_BASE			(PUV3_APB_BASE + 0x100000) /* APB-1 */
-- 
1.7.9.5

