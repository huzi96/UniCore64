From 665ffce99ad0a070c5acdc298a6c3be5699249fb Mon Sep 17 00:00:00 2001
From: Guan Xuetao <gxt@mprc.pku.edu.cn>
Date: Tue, 21 Feb 2012 11:33:46 +0800
Subject: [PATCH 305/641] UniCore64: introduce UC64_SPAGE_* definitions

Signed-off-by: Guan Xuetao <gxt@mprc.pku.edu.cn>
---
 arch/unicore64/include/arch/hwdef-pgtable.h |    5 +++++
 arch/unicore64/mm/mmu.c                     |    2 +-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/arch/unicore64/include/arch/hwdef-pgtable.h b/arch/unicore64/include/arch/hwdef-pgtable.h
index 605eb06..1604ace 100644
--- a/arch/unicore64/include/arch/hwdef-pgtable.h
+++ b/arch/unicore64/include/arch/hwdef-pgtable.h
@@ -28,6 +28,11 @@
 #define UC64_PMD_SIZE		__BP(UC64_PMD_SHIFT)
 #define UC64_PMD_MASK		__BM(UC64_PMD_BITS, UC64_PMD_SHIFT)
 
+#define UC64_SPAGE_BITS		(21)
+#define UC64_SPAGE_SIZE		__BP(UC64_SPAGE_BITS)
+#define UC64_SPAGE_MASK		__BM(UC64_SPAGE_BITS, 0)
+#define UC64_SPAGE_SELECT	__BS(UC64_SPAGE_BITS, 0)
+
 #define UC64_PGD_BITS		(UC64_PAGE_BITS - UC64_PGTBL_ENTRY_BITS)
 #define UC64_PGD_SHIFT		(UC64_PMD_SHIFT + UC64_PGD_BITS)
 #define UC64_PGD_SIZE		__BP(UC64_PGD_SHIFT)
diff --git a/arch/unicore64/mm/mmu.c b/arch/unicore64/mm/mmu.c
index 8804047..8261997 100644
--- a/arch/unicore64/mm/mmu.c
+++ b/arch/unicore64/mm/mmu.c
@@ -19,7 +19,7 @@ static void __init uc64_create_direct_mapping(phys_addr_t start,
 	pmd_t *pmd;
 
 	/* ONLY SUPERPAGE supported */
-	if ((start | length) & ~UC64_PMD_MASK)
+	if ((start | length) & UC64_SPAGE_SELECT)
 		BUG();
 
 	/* the first pud has been written in head.S */
-- 
1.7.9.5

