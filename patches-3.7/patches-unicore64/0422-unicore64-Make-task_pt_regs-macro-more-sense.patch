From 6da0d20e46756fa8db9de75cb5e8c032bbe80869 Mon Sep 17 00:00:00 2001
From: Guan Xuetao <gxt@mprc.pku.edu.cn>
Date: Fri, 7 Sep 2012 14:04:51 +0800
Subject: [PATCH 422/641] unicore64: Make task_pt_regs macro more sense

Signed-off-by: Guan Xuetao <gxt@mprc.pku.edu.cn>
---
 arch/unicore64/include/asm/processor.h |    5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/arch/unicore64/include/asm/processor.h b/arch/unicore64/include/asm/processor.h
index 353454a..68f72b7 100644
--- a/arch/unicore64/include/asm/processor.h
+++ b/arch/unicore64/include/asm/processor.h
@@ -53,8 +53,9 @@ extern unsigned long get_wchan(struct task_struct *p);
 
 /* Return some info about the user process TASK. */
 #define KSTK_PTREGS_GAP		L1_CACHE_BYTES /* Only one word for canary */
-#define task_pt_regs(p)	((struct pt_regs *) \
-		(task_stack_page(p) + THREAD_SIZE - KSTK_PTREGS_GAP) - 1)
+#define task_pt_regs(tsk)	((struct pt_regs *)			\
+				(task_stack_page(tsk) + THREAD_SIZE	\
+				- KSTK_PTREGS_GAP - sizeof(struct pt_regs)))
 /* Aliases for pc and sp (used in fs/proc/array.c) */
 #define KSTK_EIP(tsk)  (task_pt_regs(tsk)->UC64_R31)
 #define KSTK_ESP(tsk)  (task_pt_regs(tsk)->UC64_R29)
-- 
1.7.9.5

