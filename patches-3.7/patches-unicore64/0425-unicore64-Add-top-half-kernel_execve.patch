From 61d2570c3c64f0a5bb548a098265fff5a7684ba5 Mon Sep 17 00:00:00 2001
From: Guan Xuetao <gxt@mprc.pku.edu.cn>
Date: Fri, 7 Sep 2012 14:47:09 +0800
Subject: [PATCH 425/641] unicore64: Add top-half kernel_execve

Signed-off-by: Guan Xuetao <gxt@mprc.pku.edu.cn>
---
 arch/unicore64/kernel/process.c |   20 ++++++++++++++++++++
 arch/unicore64/kernel/sys.c     |   16 ----------------
 2 files changed, 20 insertions(+), 16 deletions(-)

diff --git a/arch/unicore64/kernel/process.c b/arch/unicore64/kernel/process.c
index 6792443..14e2878 100644
--- a/arch/unicore64/kernel/process.c
+++ b/arch/unicore64/kernel/process.c
@@ -3,6 +3,26 @@
 
 #include <arch/asm-common.h>
 
+/**
+ * kernel_execve() -
+ * @filename:
+ * @argv:
+ * @envp:
+ */
+int kernel_execve(const char *filename, const char *const argv[],
+		const char *const envp[])
+{
+	struct pt_regs *regs = task_pt_regs(current_thread_info()->task);
+	int ret = do_execve(filename, argv, envp, regs);
+
+	if (ret < 0)
+		return ret;
+
+	/* FIXME */
+	BUG();
+	return 0;
+}
+
 static void __noreturn kernel_thread_helper(void *unused,
 		int (*fn)(void *), void *arg)
 {
diff --git a/arch/unicore64/kernel/sys.c b/arch/unicore64/kernel/sys.c
index af561a9..ae7943c 100644
--- a/arch/unicore64/kernel/sys.c
+++ b/arch/unicore64/kernel/sys.c
@@ -1,17 +1 @@
 #include <linux/kernel.h>
-#include <linux/bug.h>
-
-/**
- * kernel_execve() -
- * @filename:
- * @argv:
- * @envp:
- */
-int kernel_execve(const char *filename,
-		  const char *const argv[],
-		  const char *const envp[])
-{
-	/* FIXME */
-	BUG();
-	return 0;
-}
-- 
1.7.9.5

