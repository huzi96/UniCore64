From 05951daeb5b8561f1927085c188b65daa0c8a8ba Mon Sep 17 00:00:00 2001
From: Guan Xuetao <gxt@mprc.pku.edu.cn>
Date: Fri, 2 Nov 2012 13:46:15 +0800
Subject: [PATCH 459/641] unicore64: Use r16 as temp reg to simplize
 head_macro.S

Signed-off-by: Guan Xuetao <gxt@mprc.pku.edu.cn>
---
 arch/unicore64/boot/boot.S                |    6 +++---
 arch/unicore64/include/arch/head-macros.S |   20 ++++++++++----------
 arch/unicore64/kernel/head.S              |    4 ++--
 3 files changed, 15 insertions(+), 15 deletions(-)

diff --git a/arch/unicore64/boot/boot.S b/arch/unicore64/boot/boot.S
index 0dc4674..7a12185 100644
--- a/arch/unicore64/boot/boot.S
+++ b/arch/unicore64/boot/boot.S
@@ -7,8 +7,8 @@
 	.section	".start"
 	.globl		_start
 _start:
-	__head_init	r0
-	__cache_init	r0
+	__head_init
+	__cache_init
 
 	dmovl		sp, #UC64_PM_ZIMAGE_STACKTOP
 
@@ -30,7 +30,7 @@ _start:
 
 	/* Re-initialize to system default status */
 	__flush_dcache
-	__head_init	r0
+	__head_init
 
 	/*
 	 * Jump to the start address of kernel image.
diff --git a/arch/unicore64/include/arch/head-macros.S b/arch/unicore64/include/arch/head-macros.S
index 5aa63eb..6a2f15e 100644
--- a/arch/unicore64/include/arch/head-macros.S
+++ b/arch/unicore64/include/arch/head-macros.S
@@ -12,11 +12,11 @@
  * .... .... ..BS IDAM
  * .... .... ..10 0000
  */
-.macro	__head_init, rt
-	dmovl		&rt, #ASR_MODE_PRIV | ASR_INTR_SELECT
-	dmov		asr, &rt
-	dmov		&rt, #CP0_CTRLREG_DEFAULT
-	movc		CP0_CTRLREG, &rt, #0
+.macro	__head_init
+	dmovl		r16, #ASR_MODE_PRIV | ASR_INTR_SELECT
+	dmov		asr, r16
+	dmov		r16, #CP0_CTRLREG_DEFAULT
+	movc		CP0_CTRLREG, r16, #0
 .endm
 
 /*
@@ -43,16 +43,16 @@
 /*
  * __cache_init - invalid and enable icache and dcache
  */
-.macro	__cache_init, rt
+.macro	__cache_init
 	__invalid_dcache
 	__invalid_icache
 
-	movc		&rt, p0.c1, #0;
+	movc		r16, p0.c1, #0;
 #ifndef CONFIG_CPU_DCACHE_DISABLE
-	dor		&rt, &rt, #4;
+	dor		r16, r16, #4;
 #endif
 #ifndef CONFIG_CPU_ICACHE_DISABLE
-	dor		&rt, &rt, #8;
+	dor		r16, r16, #8;
 #endif
-	movc		p0.c1, &rt, #0;
+	movc		p0.c1, r16, #0;
 .endm
diff --git a/arch/unicore64/kernel/head.S b/arch/unicore64/kernel/head.S
index 9bd65a0..856c3a6 100644
--- a/arch/unicore64/kernel/head.S
+++ b/arch/unicore64/kernel/head.S
@@ -29,8 +29,8 @@
  */
 	__HEAD
 ENTRY(stext)
-	__head_init	r0
-	__cache_init	r0
+	__head_init
+	__cache_init
 
 	/*
 	 * Enable the MMU.  This completely changes the structure of the visible
-- 
1.7.9.5

