From 0b536ef5b25429a7eccfcceb957d18275aec4a2f Mon Sep 17 00:00:00 2001
From: Guan Xuetao <gxt@mprc.pku.edu.cn>
Date: Wed, 9 Jan 2013 15:37:26 +0800
Subject: [PATCH 531/641] unicore64: Remove useless KSP assignments

Signed-off-by: Guan Xuetao <gxt@mprc.pku.edu.cn>
---
 arch/unicore64/include/asm/processor.h |    1 -
 arch/unicore64/kernel/process.c        |    3 ---
 2 files changed, 4 deletions(-)

diff --git a/arch/unicore64/include/asm/processor.h b/arch/unicore64/include/asm/processor.h
index 990d014..93d8c7a 100644
--- a/arch/unicore64/include/asm/processor.h
+++ b/arch/unicore64/include/asm/processor.h
@@ -61,7 +61,6 @@ extern unsigned long get_wchan(struct task_struct *p);
 ({									\
 	unsigned long *stack = (unsigned long *)sp;			\
 	memset(regs->uc64_regs, 0, sizeof(regs->uc64_regs));		\
-	regs->UC64_KSP = (unsigned long)regs; /* keep kernel-mode sp */	\
 	regs->UC64_ASR = ASR_MODE_USER;					\
 	regs->UC64_R31 = pc;		/* pc */                        \
 	regs->UC64_R29 = sp;		/* sp */                        \
diff --git a/arch/unicore64/kernel/process.c b/arch/unicore64/kernel/process.c
index c3033f2..69986d0 100644
--- a/arch/unicore64/kernel/process.c
+++ b/arch/unicore64/kernel/process.c
@@ -36,9 +36,6 @@ int copy_thread(unsigned long clone_flags, unsigned long stack_start,
 		childregs->UC64_R29 = stack_start;
 	}
 
-	/* Kernel-mode SP should be ALWAYS kept for re-entrance */
-	childregs->UC64_KSP = (unsigned long)childregs + sizeof(struct pt_regs);
-
 	return 0;
 }
 
-- 
1.7.9.5

