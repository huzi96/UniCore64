From 8ec737b2a2c0ba062d299a65347b8aaf5ff04712 Mon Sep 17 00:00:00 2001
From: Li Binbin <libinbin@mprc.pku.edu.cn>
Date: Wed, 19 Feb 2014 15:03:19 +0800
Subject: [PATCH 568/641] unicore64: Change cpuinfo struct to PER_CPU

Signed-off-by: Li Binbin <libinbin@mprc.pku.edu.cn>
---
 arch/unicore64/kernel/cpu-uc64.c |    9 ++++++---
 1 file changed, 6 insertions(+), 3 deletions(-)

diff --git a/arch/unicore64/kernel/cpu-uc64.c b/arch/unicore64/kernel/cpu-uc64.c
index 70809cd..b6a0ce4 100644
--- a/arch/unicore64/kernel/cpu-uc64.c
+++ b/arch/unicore64/kernel/cpu-uc64.c
@@ -1,15 +1,18 @@
 #include <linux/kernel.h>
 #include <linux/seq_file.h>
 #include <linux/cpu.h>
+#include <linux/percpu.h>
 
-static struct cpu cpuinfo_unicore64;
+static DEFINE_PER_CPU(struct cpu, cpuinfo_unicore64);
 
 static int __init topology_init(void)
 {
 	int i;
 
-	for_each_possible_cpu(i)
-		register_cpu(&cpuinfo_unicore64, i);
+	for_each_possible_cpu(i) {
+		struct cpu *c = &per_cpu(cpuinfo_unicore64, i);
+		register_cpu(c, i);
+	}
 
 	return 0;
 }
-- 
1.7.9.5

