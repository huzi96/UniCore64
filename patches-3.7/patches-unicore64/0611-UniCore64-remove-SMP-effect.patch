From 8588246cdf189f0ec942d0a4bcab9ba5e95f6dfe Mon Sep 17 00:00:00 2001
From: Guan Xuetao <gxt@mprc.pku.edu.cn>
Date: Thu, 24 Apr 2014 18:19:32 +0800
Subject: [PATCH 611/641] UniCore64: remove SMP effect

Signed-off-by: Guan Xuetao <gxt@mprc.pku.edu.cn>
---
 arch/unicore64/kernel/entry.S |    6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/arch/unicore64/kernel/entry.S b/arch/unicore64/kernel/entry.S
index 1dd5d7d..3821a77 100644
--- a/arch/unicore64/kernel/entry.S
+++ b/arch/unicore64/kernel/entry.S
@@ -85,13 +85,12 @@ ENTRY(ret_from_kthread)
 ENDPROC(ret_from_kthread)
 
 ENTRY(__vec_int_kernel)
+#ifdef CONFIG_SMP
 	__context_save
 
-#ifdef CONFIG_SMP
 	@ void ipi_handler(struct pt_regs *regs)
 	dmov		r0, sp
 	call		ipi_handler
-#endif
 
 	ldd		r17, [sp+], #240	@ get bsr
 	dand		r17, r17, #7
@@ -100,6 +99,9 @@ ENTRY(__vec_int_kernel)
 
 	__context_restore
 	eret
+#else
+	call __vec_invalid
+#endif
 ENDPROC(__vec_int_kernel)
 
 ENTRY(__vec_invalid)
-- 
1.7.9.5

