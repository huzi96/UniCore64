From 5f24d797d09e201b8635479c89024366c72886c7 Mon Sep 17 00:00:00 2001
From: Zhan Yuefeng <zhanyuefeng@mprc.pku.edu.cn>
Date: Thu, 15 May 2014 08:57:28 +0800
Subject: [PATCH 635/641] UniCore64: Force to use swiotlb

---
 arch/unicore64/include/asm/dma-mapping.h |    5 ++---
 2 files changed, 10 insertions(+), 4 deletions(-)

diff --git a/arch/unicore64/include/asm/dma-mapping.h b/arch/unicore64/include/asm/dma-mapping.h
index 394cd86..267c7d6 100644
--- a/arch/unicore64/include/asm/dma-mapping.h
+++ b/arch/unicore64/include/asm/dma-mapping.h
@@ -31,10 +31,9 @@ extern struct dma_map_ops swiotlb_dma_map_ops;
 
 static inline bool dma_capable(struct device *dev, dma_addr_t addr, size_t size)
 {
-	if (dev && dev->dma_mask)
-		return addr + size - 1 <= *dev->dma_mask;
+	/* Force to use swiotlb */
 
-	return 1;
+	return 0;
 }
 
 static inline dma_addr_t phys_to_dma(struct device *dev, phys_addr_t paddr)
-- 
1.7.9.5

